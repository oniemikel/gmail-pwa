<!doctype html>
<html lang="ja">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Handling mailto…</title>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; frame-ancestors 'none'; script-src 'self'">
    <style>
        body {
            font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif;
            margin: 24px;
        }

        .muted {
            color: #6b7280;
            font-size: 14px;
        }

        code {
            background: #f3f4f6;
            padding: 2px 6px;
            border-radius: 6px;
        }
    </style>
</head>

<body>
    <p>Gmail の作成画面へ転送します…</p>
    <p class="muted">自動で移動しない場合は <a id="fallback" href="#">こちら</a> をクリックしてください。</p>

    <script>
        (function () {
            const params = new URLSearchParams(location.search);
            const original = params.get("url") || "";

            // mailto: を取り出し
            const mailto = decodeURIComponent(original).replace(/^mailto:/, "");

            // 宛先とクエリに分割
            const [toPart, queryPart] = mailto.split("?");
            const qs = new URLSearchParams(queryPart || "");

            // 各フィールドを Gmail 用に変換
            const to = encodeURIComponent(toPart || "");
            const cc = encodeURIComponent(qs.get("cc") || "");
            const bcc = encodeURIComponent(qs.get("bcc") || "");
            const subject = encodeURIComponent(qs.get("subject") || "");
            const body = encodeURIComponent(qs.get("body") || "");

            // Gmail compose URL
            const gmail =
                `https://mail.google.com/mail/?view=cm&fs=1` +
                (to ? `&to=${to}` : "") +
                (cc ? `&cc=${cc}` : "") +
                (bcc ? `&bcc=${bcc}` : "") +
                (subject ? `&su=${subject}` : "") +
                (body ? `&body=${body}` : "");

            // フォールバックリンク設定
            document.getElementById("fallback").href = gmail;

            // 自動遷移
            location.replace(gmail);
        })();
    </script>
</body>

</html>